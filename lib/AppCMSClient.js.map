{"version":3,"file":"AppCMSClient.js","sourceRoot":"","sources":["../src/AppCMSClient.ts"],"names":[],"mappings":"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","sourcesContent":["import fetch, {RequestInit} from 'node-fetch'\nimport * as FormData from 'form-data'\nimport * as FileList from 'node-filelist'\n\nexport interface AppCMSClientConfig {\n    apiKey: string\n    baseUrl?: string\n\n}\n\nexport class AppCMSClient<Content> {\n\n    private baseURL: string = \"https://www.appcms.dk\"\n    private accessToken: string = ''\n\n    constructor(\n        private clientConfig: AppCMSClientConfig\n    ) {\n\n        if(clientConfig.baseUrl) {\n            this.baseURL = clientConfig.baseUrl\n        }\n\n    }\n\n    public setAccessToken = (token: string) => {\n        this.accessToken = token\n    }\n\n    private generateURL = (endpoint: string, withAPIKey: boolean = true) => {\n        let url = `${this.baseURL}`\n\n        if(withAPIKey) {\n            url += `/api/${this.clientConfig.apiKey}`\n        }\n\n        if(endpoint.charAt(0) !== \"/\") {\n            return `${url}/${endpoint}`\n        }\n\n        return `${url}${endpoint}`\n    }\n\n    private makeRequest = async (url: string, method=\"get\", data?: any): Promise<Content> => {\n        const requestOptions: RequestInit = {\n            method,\n            headers: {},\n        }\n\n        if(this.accessToken.length > 0) {\n            requestOptions.headers[\"authorization\"] = `Bearer ${this.accessToken}`\n        }\n\n\n\n        switch (method.toLowerCase()) {\n            case \"post\":\n            case \"patch\":\n            case 'put':\n                requestOptions.method = method\n\n                if(data instanceof FormData) {\n                    requestOptions.body = data\n                }\n                else {\n                    requestOptions.body = JSON.stringify(data)\n                    requestOptions.headers['content-type'] = 'application/json'\n                }\n\n\n                break\n        }\n\n        console.log(`[Request] init - ${url} - ${method} - ${JSON.stringify(data)} - ${JSON.stringify(requestOptions.headers)}`)\n\n\n        const response = await fetch(url, requestOptions)\n        const contentType: string|undefined = response.headers[\"content-type\"]\n\n        if(contentType && contentType.toLowerCase() !== \"application/json\") {\n            const text = await response.text()\n\n        }\n\n        const json = await response.json()\n\n\n        return json\n    }\n\n\n    get analytics() {\n        return {\n            log: (event: string, platform: string, deviceId: string, data?: string) => {\n                return this.makeRequest(this.generateURL(\"/analytics/log\"), \"post\", {\n                    analytic: {\n                        event,\n                        platform,\n                        device_id: deviceId,\n                        data\n                    }\n                })\n            }\n        }\n    }\n\n\n    get appConfig() {\n        return {\n            fetch: () => {\n                return this.makeRequest(this.generateURL(`/app_config`))\n            }\n        }\n    }\n\n    get content() {\n        return {\n            fetch: (locale: string): Promise<Content> => {\n                return this.makeRequest(this.generateURL(`/content/${locale}`))\n            },\n            file: (fileId: string) => {\n                return this.makeRequest(this.generateURL(`/content/file/${fileId}`))\n            }\n        }\n    }\n\n\n    get vinduesgrossisten() {\n        const self = this\n        function tasks(date: string) {\n            return this.makeRequest(this.generateURL(`/vinduesgrossisten/tasks?date=${date}`))\n        }\n\n        return {\n            login: (accessKey: string) => {\n                return this.makeRequest(this.generateURL(`/vinduesgrossisten/engineer-login`), \"post\", {access_key: accessKey})\n            },\n            tasks: (date: string) => {\n                return this.makeRequest(this.generateURL(`/vinduesgrossisten/tasks?date=${date}`))\n            },\n            taskUpdate: (taskId: string, values: {note?: string, materials?: string}) => {\n                return this.makeRequest(this.generateURL(`/vinduesgrossisten/tasks/${taskId}`), \"patch\", values)\n            },\n            tasksUpdateStatus: (taskId: string|number, statusId: string, note: string)  => {\n                return this.makeRequest(this.generateURL(`/vinduesgrossisten/tasks/${taskId}/status`), \"put\", {vin_status_id: statusId, note})\n            },\n            statuses: () => {\n                return this.makeRequest(this.generateURL(`/vinduesgrossisten/statuses`))\n            },\n\n            notes: (taskId: string|number) => {\n                const baseUrl = this.generateURL(`/vinduesgrossisten/tasks/${taskId}/notes`)\n                const generateURL = (endpoint: string) => {\n                    return `${baseUrl}${endpoint}`\n                }\n\n\n                return {\n                    get() {\n\n                    }\n                }\n            },\n\n\n            taskCreateDocumentations(taskId: number|string, data: FormData) {\n                return self.makeRequest(self.generateURL(`/vinduesgrossisten/tasks/${taskId}/documentations`), 'post', data)\n            },\n\n            taskUpdateDocumentations(taskId: number|string, values: {note?: string}) {\n                return self.makeRequest(self.generateURL(`/vinduesgrossisten/tasks/${taskId}/documentations`), 'patch', values)\n            },\n\n            taskDeleteDocumentation(taskId: number|string, documentationId: string|number) {\n                return self.makeRequest(self.generateURL(`/vinduesgrossisten/tasks/${taskId}/documentations/${documentationId}`), \"delete\")\n            },\n\n            /**\n             *\n             * @param taskId\n             * @param documentationId\n             * @param image There is only one field in the object images[image] = file\n             */\n            taskAddDocumentationImage(taskId: number|string, documentationId: string|number, image: FormData) {\n                return self.makeRequest(self.generateURL(`/vinduesgrossisten/tasks/${taskId}/documentations/${documentationId}/images`), \"post\", image)\n            },\n\n            taskDeleteDocumentationImage(taskId: number|string, documentationId: string|number, imageId: string|number) {\n                return self.makeRequest(self.generateURL(`/vinduesgrossisten/tasks/${taskId}/documentations/${documentationId}/images/${imageId}`), \"delete\")\n            },\n        }\n    }\n\n}\n\n"]}